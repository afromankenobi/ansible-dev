---
# roles/ohmyzsh/tasks/main.yml
# Install Oh-My-Zsh framework
# Note: Zsh plugins (autosuggestions, syntax-highlighting) are installed via
# Homebrew in the dotfiles role, not as Oh-My-Zsh custom plugins

- name: Install zsh (Debian only)
  become: true
  apt:
    name: zsh
  when: ansible_facts["os_family"] == "Debian"

- name: Check if Oh-My-Zsh is already installed
  stat:
    path: "{{ ansible_facts['env']['HOME'] }}/.oh-my-zsh"
  register: ohmyzsh_installed

- name: Clone Oh-My-Zsh framework
  git:
    repo: https://github.com/robbyrussell/oh-my-zsh.git
    dest: "{{ ansible_facts['env']['HOME'] }}/.oh-my-zsh"
    accept_hostkey: yes
    depth: 1
  when: not ohmyzsh_installed.stat.exists

- name: Set zsh as default shell (Debian only)
  become: true
  user:
    name: "{{ ansible_user_id }}"
    shell: /bin/zsh
  when: ansible_facts["os_family"] == "Debian"

# Note for macOS:
# On macOS, zsh is the default shell since macOS Catalina (10.15).
# If you need to change it manually: chsh -s /bin/zsh
# Or: System Settings → Users & Groups → Advanced Options → Login Shell
